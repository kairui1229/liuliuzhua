{"version":3,"file":"login.js","sources":["pages/login/login.vue","../../Hbuilder/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\r\n\t<view class=\"login-container\">\r\n\t\t<!-- 顶部背景 -->\r\n\t\t<view class=\"login-header\">\r\n\t\t\t<view class=\"header-content\">\r\n\t\t\t\t<image class=\"logo\" src=\"/static/logo.png\" mode=\"\"></image>\r\n\t\t\t\t<text class=\"app-name\">溜溜爪宠物服务</text>\r\n\t\t\t\t<text class=\"app-slogan\">让爱宠生活更美好</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 登录表单 -->\r\n\t\t<view class=\"login-form\">\r\n\t\t\t<!-- 小程序登录 -->\r\n\t\t\t<view class=\"login-content\" v-if=\"platform==='mp-weixin'\">\r\n\t\t\t\t<view class=\"quick-login\">\r\n\t\t\t\t\t<text class=\"login-title\">手机号快捷登录</text>\r\n\t\t\t\t\t<text class=\"login-desc\">使用微信授权快捷登录</text>\r\n\t\t\t\t\t<!-- <button class=\"wechat-login-btn\" open-type=\"getPhoneNumber\" @getphonenumber=\"getPhoneNumber\">\r\n\t\t\t\t\t\t<up-icon name=\"weixin-fill\" color=\"#fff\" size=\"32\" style=\"margin-right: 10rpx;\"></up-icon>\r\n\t\t\t\t\t\t微信获取手机号一键登录\r\n\t\t\t\t\t</button> -->\r\n\t\t\t\t\t<!--没有企业身份用这段代码登录，不影响后续流程-->\r\n\t\t\t\t\t<button class=\"wechat-login-btn\"  @click=\"fn\">\r\n\t\t\t\t\t\t<up-icon name=\"weixin-fill\" color=\"#fff\" size=\"32\" style=\"margin-right: 10rpx;\"></up-icon>\r\n\t\t\t\t\t\t微信获取手机号一键登录\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- h5 app登录 -->\r\n\t\t\t<view v-else>\r\n\t\t\t\t<view class=\"login-content\">\r\n\t\t\t\t\t<text class=\"login-title\">手机号登录</text>\r\n\t\t\t\t\t<text class=\"login-desc\">请输入手机号和验证码</text>\r\n\t\t\t\t\t<view class=\"input-group\">\r\n\t\t\t\t\t\t<view class=\"input-item\">\r\n\t\t\t\t\t\t\t<up-input\r\n\t\t\t\t\t\t\t    placeholder=\"请输入手机号\"\r\n\t\t\t\t\t\t\t\tprefixIcon=\"phone\"\r\n\t\t\t\t\t\t\t\tborder=\"none\"\r\n\t\t\t\t\t\t\t\tprefixIconStyle=\"font-size: 22px;color: #909399\"\r\n\t\t\t\t\t\t\t\tv-model=\"phone\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t</up-input>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"input-item\">\r\n\t\t\t\t\t\t\t<up-input\r\n\t\t\t\t\t\t\t\tplaceholder=\"请输入验证码\"\r\n\t\t\t\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\t\t\t\tmaxlength=\"6\"\r\n\t\t\t\t\t\t\t\tborder=\"none\"\r\n\t\t\t\t\t\t\t\tprefixIcon=\"lock\"\r\n\t\t\t\t\t\t\t\tprefixIconStyle=\"font-size: 22px;color: #909399\"\r\n\t\t\t\t\t\t\t\tv-model=\"code\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t</up-input>\r\n\t\t\t\t\t\t\t<view class=\"code-btn\" @click=\"getCode\">\r\n\t\t\t\t\t\t\t\t{{isCounting?countDown+\"s后重新获取\":\"获取验证码\"}}\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<up-button\r\n\t\t\t\t\t\t\ttype=\"primary\" \r\n\t\t\t\t\t\t\t:custom-style=\"{\r\n\t\t\t\t\t\t\tbackgroundColor:'#ffce2c',\r\n\t\t\t\t\t\t\tborderColor:'#ffce2c',\r\n\t\t\t\t\t\t\theight:'88rpx',\r\n\t\t\t\t\t\t\tfontSize:'32rpx'\r\n\t\t\t\t\t\t    }\"\r\n\t\t\t\t\t\t    @click=\"handleLogin\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t登录\r\n\t\t\t\t\t\t</up-button>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { onMounted,ref } from 'vue';\r\nimport {post} from \"../../utils/http\"\r\n\r\nconst platform = ref(\"\")\r\nonMounted(()=>{\r\n\r\n\t\tplatform.value=\"mp-weixin\"\r\n\r\n\t\r\n\r\n\r\n\r\n\t\r\n\r\n\r\n\r\n})\r\n\r\n\r\n//没有企业身份用这段代码模拟，一样可以登录不影响后面流程！！！！！！！\r\nconst fn=()=>{\r\n\tuni.setStorageSync(\"token\",\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMCwicGhvbmUiOiIxODgzODkxMzQyOSIsImlhdCI6MTc1NzEyODQzNSwiZXhwIjoxNzU3MTM1NjM1fQ.4QkIaYV04ZM7pbekxZOLcRPBu6KSdYS0npF7ZVSCIaw\")\r\n\tuni.setStorageSync(\"user\",{\"type\":\"object\",\"data\":{\"user_id\":10,\"username\":null,\"avatar\":null,\"openid\":\"\",\"phone\":\"18838913429\"}})\r\n\tuni.showToast({\r\n\t\ttitle:\"登录成功\",\r\n\t\ticon:\"success\",\r\n\t\tduration:1500\r\n\t})\r\n\tsetTimeout(()=>{\r\n\t\tuni.navigateBack();\r\n\t},500)\r\n}\r\n\r\n//微信小程序一键登录\r\n// const getPhoneNumber=async (e)=>{\r\n// \tif(e.detail.errMsg===\"getPhoneNumber:ok\"){\r\n// \t\ttry {\r\n// \t\t\tconst phoneCode=e.detail.code //动态令牌 用来获取手机号 xulaoshi666 {user_id:1,phone:18888888888}\r\n// \t\t\tconst res= await uni.login();\r\n// \t\t\tconst loginCode=res.code //身份凭证，用来获取openid\r\n// \t\t\tconst data:any=await post(\"/auth/wxLogin\",{\r\n// \t\t\t\tloginCode,\r\n// \t\t\t\tphoneCode,\r\n// \t\t\t\tappid:\"你的企业appid\",//换成你的企业appid,\r\n// \t\t\t\tsecret:\"你的企业小程序密钥\" ,//换成你的企业小程序密钥，密钥属于隐私数据，泄露会影响账号，所以不展示\r\n// \t\t\t\t\t\t\t\t\t\t\t//如果你没有真实企业的id和密钥，可以来找徐老师，实名登记申请，徐老师会把密钥等借给你体验\r\n// \t\t\t});\r\n// \t\t\tuni.setStorageSync(\"token\",data.token)\r\n// \t\t\tuni.setStorageSync(\"user\",data.user)\r\n// \t\t\tuni.showToast({\r\n// \t\t\t\ttitle:\"登陆成功\",\r\n// \t\t\t\ticon:\"success\",\r\n// \t\t\t\tduration:1500\r\n// \t\t\t})\r\n// \t\t\tsetTimeout(()=>{\r\n// \t\t\t\tuni.navigateBack();\r\n// \t\t\t},500)\r\n\t\t\t\r\n\t\t\t\r\n// \t\t} catch (error) {\r\n// \t\t\t//TODO handle the exception\r\n// \t\t}\t\t\r\n// \t}else{\r\n// \t\tuni.showToast({\r\n// \t\t\ttitle:\"获取失败\",\r\n// \t\t\ticon:\"error\"\r\n// \t\t})\r\n// \t}\r\n// }\r\n\r\n//手机号验证码登录\r\nconst phone=ref<string>(\"\")\r\nconst code=ref<string>(\"\")\r\n//倒计时相关\r\nconst countDown=ref<number>(60);\r\nconst isCounting=ref<boolean>(false)\r\n\r\nconst sendCode=async ()=>{\r\n\ttry {\r\n\t\tconst data:any=await post(\"/auth/sendSmsCode\",{phone:phone.value});\r\n\t\tuni.__f__('log','at pages/login/login.vue:162',\"验证码已发送\",data)\r\n\t} catch (error) {\r\n\t\tuni.__f__('log','at pages/login/login.vue:164',\"验证码发送失败\")\r\n\t}\r\n}\r\n\r\nconst getCode=()=>{\r\n\tif(isCounting.value) return;\r\n\t//判断手机号格式\r\n\tconst phoneReg=/^1[3-9]\\d{9}$/;\r\n\tif(!phoneReg.test(phone.value)){\r\n\t\tuni.showToast({\r\n\t\t\ttitle:\"请输入正确的手机号\",\r\n\t\t\ticon:\"none\"\r\n\t\t})\r\n\t\treturn\r\n\t}\r\n\tisCounting.value=true;\r\n\tcountDown.value=60;\r\n\tconst timer=setInterval(()=>{\r\n\t\tcountDown.value--\r\n\t\tif(countDown.value<=0){\r\n\t\t\tclearInterval(timer);\r\n\t\t\tisCounting.value=false;\t\t\r\n\t\t}\r\n\t},1000)\r\n\t//发送验证码\r\n\tsendCode()\r\n}\r\n\r\nconst handleLogin=async ()=>{\r\n\tconst phoneReg=/^1[3-9]\\d{9}$/;\r\n\tif(phoneReg.test(phone.value)&&code.value){\r\n\t\ttry {\r\n\t\t\tconst data:any=await post(\"/auth/verifySmsCode\",{phone:phone.value,code:code.value});\r\n\t\t\tuni.__f__('log','at pages/login/login.vue:197',\"登录结果\",data)\r\n\t\t\tuni.setStorageSync(\"token\",data.token)\r\n\t\t\tuni.setStorageSync(\"user\",data.user)\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle:\"登录成功\",\r\n\t\t\t\ticon:\"success\",\r\n\t\t\t\tduration:1500\r\n\t\t\t})\r\n\t\t\tsetTimeout(()=>{\r\n\t\t\t\tuni.navigateBack();\r\n\t\t\t},500)\r\n\t\t} catch (error) {\r\n\t\t\tuni.__f__('log','at pages/login/login.vue:209',\"登录失败\")\r\n\t\t}\r\n\t}else{\r\n\t\tuni.showToast({\r\n\t\t\ttitle:\"请输入正确的信息\",\r\n\t\t\ticon:\"none\"\r\n\t\t})\t\t\r\n\t}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.login-container{\r\n\theight: 100vh;\r\n\tbackground: linear-gradient(135deg,#ffce2c 0%,#ffb347 100%);\r\n\t.login-header{\r\n\t\theight: 500rpx;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\t.header-content{\r\n\t\t\ttext-align: center;\r\n\t\t\t.logo{\r\n\t\t\t\twidth:120rpx;\r\n\t\t\t\theight: 120rpx;\r\n\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t}\r\n\t\t\t.app-name{\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tfont-size: 48rpx;\r\n\t\t\t\tfont-weight: bold;\r\n\t\t\t\tcolor: #fff;\r\n\t\t\t\tmargin-bottom: 10rpx;\r\n\t\t\t}\r\n\t\t\t.app-slogan{\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: rgba(255, 255, 255, 0.8);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t.login-form{\r\n\t\tbackground-color: #fff;\r\n\t\tborder-radius: 40rpx 40rpx 0 0;\r\n\t\tpadding: 60rpx 40rpx;\r\n\t\tmargin-top: -40rpx;\r\n\t\theight: calc(100vh - 580rpx);\r\n\t\t.login-content{\r\n\t\t\t.login-title{\r\n\t\t\t\tfont-size: 36rpx;\r\n\t\t\t\tfont-weight: bold;\r\n\t\t\t\tcolor: #333;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t}\r\n\t\t\t.login-desc{\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #999;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tmargin-bottom: 60rpx;\r\n\t\t\t}\r\n\t\t\t.wechat-login-btn{\r\n\t\t\t\tbackground-color: #07c160;\r\n\t\t\t\tcolor: #fff;\r\n\t\t\t\tborder: none;\r\n\t\t\t\tborder-radius: 16rpx;\r\n\t\t\t\theight: 88rpx;\r\n\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\tmargin-top: 60rpx;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\t\t\t.input-group{\r\n\t\t\t\tmargin-bottom: 60rpx;\r\n\t\t\t\t.input-item{\r\n\t\t\t\t\tbackground-color: #f8f8f8;\r\n\t\t\t\t\tborder-radius: 16rpx;\r\n\t\t\t\t\tpadding: 30rpx 20rpx;\r\n\t\t\t\t\tmargin-bottom: 30rpx;\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t.code-btn{\r\n\t\t\t\t\t\tpadding:10rpx 20rpx ;\r\n\t\t\t\t\t\tbackground-color: #ffce2c;\r\n\t\t\t\t\t\tcolor: #fff;\r\n\t\t\t\t\t\tborder-radius: 8rpx;\r\n\t\t\t\t\t\tfont-size: 24rpx;\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</style>","import MiniProgramPage from 'D:/uni-app项目/liuliuzhua/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","uni","post"],"mappings":";;;;;;;;;;;;;;;;;;;AAoFM,UAAA,WAAWA,kBAAI,EAAE;AACvBC,kBAAAA,UAAU,MAAI;AAEZ,eAAS,QAAM;AAAA,IAAA,CAUhB;AAID,UAAM,KAAG,MAAI;AACRC,oBAAAA,MAAA,eAAe,SAAQ,iLAAiL;AAC5MA,0BAAI,eAAe,QAAO,EAAC,QAAO,UAAS,QAAO,EAAC,WAAU,IAAG,YAAW,MAAK,UAAS,MAAK,UAAS,IAAG,SAAQ,iBAAe;AACjIA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAM;AAAA,QACN,MAAK;AAAA,QACL,UAAS;AAAA,MAAA,CACT;AACD,iBAAW,MAAI;AACdA,sBAAA,MAAI,aAAa;AAAA,SAChB,GAAG;AAAA,IAAA;AAyCA,UAAA,QAAMF,kBAAY,EAAE;AACpB,UAAA,OAAKA,kBAAY,EAAE;AAEnB,UAAA,YAAUA,kBAAY,EAAE;AACxB,UAAA,aAAWA,kBAAa,KAAK;AAEnC,UAAM,WAAS,YAAU;AACpB,UAAA;AACG,cAAA,OAAS,MAAMG,iBAAAA,KAAK,qBAAoB,EAAC,OAAM,MAAM,OAAM;AACjED,sBAAA,MAAI,MAAM,OAAM,gCAA+B,UAAS,IAAI;AAAA,eACpD,OAAO;AACXA,sBAAAA,MAAA,MAAM,OAAM,gCAA+B,SAAS;AAAA,MACzD;AAAA,IAAA;AAGD,UAAM,UAAQ,MAAI;AACjB,UAAG,WAAW;AAAO;AAErB,YAAM,WAAS;AACf,UAAG,CAAC,SAAS,KAAK,MAAM,KAAK,GAAE;AAC9BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAM;AAAA,UACN,MAAK;AAAA,QAAA,CACL;AACD;AAAA,MACD;AACA,iBAAW,QAAM;AACjB,gBAAU,QAAM;AACV,YAAA,QAAM,YAAY,MAAI;AACjB,kBAAA;AACP,YAAA,UAAU,SAAO,GAAE;AACrB,wBAAc,KAAK;AACnB,qBAAW,QAAM;AAAA,QAClB;AAAA,SACC,GAAI;AAEG;IAAA;AAGV,UAAM,cAAY,YAAU;AAC3B,YAAM,WAAS;AACf,UAAG,SAAS,KAAK,MAAM,KAAK,KAAG,KAAK,OAAM;AACrC,YAAA;AACG,gBAAA,OAAS,MAAMC,sBAAK,uBAAsB,EAAC,OAAM,MAAM,OAAM,MAAK,KAAK,MAAM,CAAA;AACnFD,wBAAA,MAAI,MAAM,OAAM,gCAA+B,QAAO,IAAI;AACtDA,wBAAAA,MAAA,eAAe,SAAQ,KAAK,KAAK;AACjCA,wBAAAA,MAAA,eAAe,QAAO,KAAK,IAAI;AACnCA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAM;AAAA,YACN,MAAK;AAAA,YACL,UAAS;AAAA,UAAA,CACT;AACD,qBAAW,MAAI;AACdA,0BAAA,MAAI,aAAa;AAAA,aAChB,GAAG;AAAA,iBACG,OAAO;AACXA,wBAAAA,MAAA,MAAM,OAAM,gCAA+B,MAAM;AAAA,QACtD;AAAA,MAAA,OACI;AACJA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAM;AAAA,UACN,MAAK;AAAA,QAAA,CACL;AAAA,MACF;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtND,GAAG,WAAW,eAAe;"}