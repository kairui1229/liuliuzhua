{"version":3,"file":"order.js","sources":["packageB/order/order.vue","../../Hbuilder/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFja2FnZUJcb3JkZXJcb3JkZXIudnVl"],"sourcesContent":["<template>\r\n\t<view class=\"order-create\">\r\n\t\t<!--收货地址-->\r\n\t\t<view class=\"address-section\" @click=\"chooseAddress\">\r\n\t\t\t<view class=\"address-content\" v-if=\"address?.name\">\r\n\t\t\t\t<view class=\"user-info\">\r\n\t\t\t\t\t<text class=\"name\">{{address.name}}</text>\r\n\t\t\t\t\t<text class=\"phone\">{{address.phone}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"address-detail\">{{address.province}}{{address.city}}{{address.district}}{{address.detail}}\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"no-address\" v-else>\r\n\t\t\t\t<text>请选择收货地址</text>\r\n\t\t\t</view>\r\n\t\t\t<up-icon name=\"arrow-right\" size=\"24\" color=\"#999\"></up-icon>\r\n\t\t</view>\r\n\r\n\t\t<!--商品列表-->\r\n\t\t<view class=\"goods-section\">\r\n\t\t\t<view class=\"section-title\">商品信息</view>\r\n\t\t\t<view class=\"goods-list\">\r\n\t\t\t\t<view class=\"goods-item\" v-for=\"item in selPro\" :key=\"item.product_id\">\r\n\t\t\t\t\t<image class=\"goods-img\" :src=\"item.main_pic\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t<view class=\"goods-info\">\r\n\t\t\t\t\t\t<view class=\"goods-name\">{{item.name}}</view>\r\n\t\t\t\t\t\t<view class=\"goods-spec\">{{item.spec}}</view>\r\n\t\t\t\t\t\t<view class=\"price-quantity\">\r\n\t\t\t\t\t\t\t<text class=\"price\">￥{{item.price}}</text>\r\n\t\t\t\t\t\t\t<text class=\"quantity\">×{{item.count}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!--配送方式-->\r\n\t\t<view class=\"delivery-section\">\r\n\t\t\t<view class=\"section-title\">配送方式</view>\r\n\t\t\t<view class=\"delivery-options\">\r\n\t\t\t\t<view class=\"delivery-item\">\r\n\t\t\t\t\t<text>快递配送</text>\r\n\t\t\t\t\t<text class=\"delivery-free\">免运费</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!--订单备注-->\r\n\t\t<view class=\"remark-section\">\r\n\t\t\t<view class=\"section-title\">订单备注</view>\r\n\t\t\t<input class=\"remark-input\" placeholder=\"请输入备注信息(选填)\" />\r\n\t\t</view>\r\n\t\t\r\n\t\t<!--金额明细-->\r\n\t\t<view class=\"amount-section\">\r\n\t\t\t<view class=\"amount-item\">\r\n\t\t\t\t<text>商品金额</text>\r\n\t\t\t\t<text>￥{{totalPrice}}</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"amount-item\">\r\n\t\t\t\t<text>运费</text>\r\n\t\t\t\t<text>￥0.00</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"amount-item total\">\r\n\t\t\t\t<text>实付金额</text>\r\n\t\t\t\t<text class=\"price\">￥{{totalPrice}}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!--底部结算-->\r\n\t\t<view class=\"settlement-bar\">\r\n\t\t\t<view class=\"total-info\">\r\n\t\t\t\t<text>合计：</text>\r\n\t\t\t\t<text class=\"price\">￥{{totalPrice}}</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"submit-btn\" @click=\"submitOrder\">立即支付</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { computed, ref } from \"vue\"\r\nimport { get,post } from \"../../utils/http\"\r\nimport { onLoad } from \"@dcloudio/uni-app\"\r\n\r\ninterface AddressItem {\r\n\tcity : string;\r\n\tdetail : string;\r\n\tdistrict : string;\r\n\tid : number;\r\n\tis_default : 1 | 0;\r\n\tname : string;\r\n\tphone : string;\r\n\tprovince : string;\r\n\tuser_id : number\r\n}\r\n\t\r\nonLoad((options) => {\r\n\tgetAddress()\r\n\tselPro.value = JSON.parse(options.selPro)\r\n\tuni.$on(\"addressSelected\", (selectedAddress) => {\r\n\t\tuni.__f__('log','at packageB/order/order.vue:102',\"选中的地址是\", selectedAddress)\r\n\t\taddress.value = selectedAddress //更新页面中显示的地址信息\r\n\t})\r\n})\r\n\r\n//地址管理\r\nconst address = ref<AddressItem>({} as AddressItem)\r\nconst getAddress = async () => {\r\n\ttry {\r\n\t\tconst result : any = await get(\"/cart/address\");\r\n\t\taddress.value = result.filter(item => item.is_default)[0]\r\n\t\tuni.__f__('log','at packageB/order/order.vue:113',address.value,233)\r\n\t} catch (error) {\r\n\t\tuni.__f__('log','at packageB/order/order.vue:115',error)\r\n\t}\r\n}\r\n//选择地址\r\nconst chooseAddress = () => {\r\n\tuni.navigateTo({\r\n\t\turl: \"/packageB/address/address?flag=1\"\r\n\t})\r\n}\r\n\r\n//商品信息\r\nconst selPro = ref([])\r\n\r\n//计算总价\r\nconst totalPrice = computed<number>(() => {\r\n\tlet total = 0;\r\n\tselPro.value.forEach(item => {\r\n\t\ttotal += Number(item.price)\r\n\t})\r\n\treturn total\r\n})\r\n\r\n//h5端支付直接就跳转到后端给我们的地址 location.href\r\nconst submitOrder= async ()=>{\r\n\r\n\ttry {\r\n\t\tconst res:any=await post(\"/payment/createOrder\",{\r\n\t\t\topenId:\"ow4MK7uyLhGxphyZJTFdyy5zD-ow\",\r\n\t\t\tproductId:\"1001\",\r\n\t\t\tproductName:\"测试商品\",\r\n\t\t\tproductPrice:0.01,\r\n\t\t\tproductNum:1\r\n\t\t})\r\n\t\tuni.__f__('log','at packageB/order/order.vue:148',\"订单结果\",res);\r\n\t\tuni.requestPayment({\r\n\t\t\tprovider:\"wxpay\",\r\n\t\t\torderInfo:\"测试订单\",\r\n\t\t\tnonceStr:res.data.nonceStr,\r\n\t\t\ttimeStamp:res.data.timeStamp,\r\n\t\t\tpackage:res.data.package,\r\n\t\t\tsignType:res.data.signType,\r\n\t\t\tpaySign:res.data.paySign,\r\n\t\t\tsuccess(payRes) {\r\n\t\t\t\tuni.__f__('log','at packageB/order/order.vue:158',\"支付成功\",payRes)\r\n\t\t\t\t//调用接口，发送自己的地址备注信息等\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\tfail(payError) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle:\"支付失败\",\r\n\t\t\t\t\ticon:\"none\"\r\n\t\t\t\t})\r\n\t\t\t\tuni.__f__('log','at packageB/order/order.vue:167',\"支付失败\",payError)\r\n\t\t\t}\r\n\t\t})\r\n\t} catch (error) {\r\n\t\tuni.__f__('log','at packageB/order/order.vue:171',error)\r\n\t}\r\n\r\n\tuni.__f__('log','at packageB/order/order.vue:174',\"支付操作\")\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.order-create {\r\n\t\tmin-height: 100vh;\r\n\t\tbackground-color: #f5f5f5;\r\n\t\tpadding-bottom: 120rpx;\r\n\r\n\t\t.address-section {\r\n\t\t\tbackground-color: #fff;\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tpadding: 30rpx;\r\n\t\t\tmargin-bottom: 20rpx;\r\n\r\n\t\t\t.address-content {\r\n\t\t\t\tflex: 1;\r\n\r\n\t\t\t\t.user-info {\r\n\t\t\t\t\tmargin-bottom: 10rpx;\r\n\r\n\t\t\t\t\t.name {\r\n\t\t\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.phone {\r\n\t\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\t\tcolor: #666;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.address-detail {\r\n\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\tcolor: #666;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t.no-address {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #999;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.goods-section {\r\n\t\t\tbackground-color: #fff;\r\n\t\t\tpadding: 30rpx;\r\n\t\t\tmargin-bottom: 20rpx;\r\n\r\n\t\t\t.section-title {\r\n\t\t\t\tfont-size: 30rpx;\r\n\t\t\t\tcolor: #333;\r\n\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t}\r\n\r\n\t\t\t.goods-list {\r\n\t\t\t\t.goods-item {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tmargin-bottom: 30rpx;\r\n\r\n\t\t\t\t\t.goods-img {\r\n\t\t\t\t\t\twidth: 160rpx;\r\n\t\t\t\t\t\theight: 160rpx;\r\n\t\t\t\t\t\tborder-radius: 12rpx;\r\n\t\t\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.goods-info {\r\n\t\t\t\t\t\tflex: 1;\r\n\r\n\t\t\t\t\t\t.goods-name {\r\n\t\t\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\t\t\tmargin-bottom: 10rpx;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t.goods-spec {\r\n\t\t\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\t\t\tcolor: #999;\r\n\t\t\t\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t.price-quantity {\r\n\t\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\t\tjustify-content: space-between;\r\n\t\t\t\t\t\t\talign-items: center;\r\n\r\n\t\t\t\t\t\t\t.price {\r\n\t\t\t\t\t\t\t\tcolor: #ff4d4f;\r\n\t\t\t\t\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t.quantity {\r\n\t\t\t\t\t\t\t\tfont-size: 26rpx;\r\n\t\t\t\t\t\t\t\tcolor: #999;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.delivery-section {\r\n\t\t\tbackground-color: #fff;\r\n\t\t\tpadding: 30rpx;\r\n\t\t\tmargin-bottom: 20rpx;\r\n\r\n\t\t\t.section-title {\r\n\t\t\t\tfont-size: 30rpx;\r\n\t\t\t\tcolor: #333;\r\n\t\t\t\tmargin-bottom: 20rpx;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t.delivery-options {\r\n\t\t\t\t.delivery-item {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tjustify-content: space-between;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\tpadding: 20rpx 0;\r\n\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\tcolor: #333;\r\n\r\n\t\t\t\t\t.delivery-free {\r\n\t\t\t\t\t\tcolor: #999;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.remark-section {\r\n\t\t\tbackground-color: #fff;\r\n\t\t\tpadding: 30rpx;\r\n\t\t\tmargin-bottom: 20rpx;\r\n\r\n\t\t\t.section-title {\r\n\t\t\t\tfont-size: 30rpx;\r\n\t\t\t\tcolor: #333;\r\n\t\t\t\tmargin-bottom: 20rpx;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t.remark-input {\r\n\t\t\t\theight: 80rpx;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #333;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.amount-section {\r\n\t\t\tbackground-color: #fff;\r\n\t\t\tpadding: 30rpx;\r\n\t\t\tmargin-bottom: 20rpx;\r\n\r\n\t\t\t.amount-item {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #666;\r\n\r\n\t\t\t\t&.total {\r\n\t\t\t\t\tborder-top: 2rpx solid #f5f5f5;\r\n\t\t\t\t\tmargin-top: 20rpx;\r\n\t\t\t\t\tpadding-top: 20rpx;\r\n\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\tfont-size: 30rpx;\r\n\r\n\t\t\t\t\t.price {\r\n\t\t\t\t\t\tcolor: #ff4d4f;\r\n\t\t\t\t\t\tfont-size: 36rpx;\r\n\t\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.settlement-bar {\r\n\t\t\tposition: fixed;\r\n\t\t\tbottom: 0;\r\n\t\t\tleft: 0;\r\n\t\t\tright: 0;\r\n\t\t\theight: 100rpx;\r\n\t\t\tpadding: 20rpx;\r\n\t\t\tbackground-color: #fff;\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tbox-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.1);\r\n\r\n\t\t\t.total-info {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #333;\r\n\r\n\t\t\t\t.price {\r\n\t\t\t\t\tcolor: #ff4d4f;\r\n\t\t\t\t\tfont-size: 36rpx;\r\n\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t.submit-btn {\r\n\t\t\t\twidth: 240rpx;\r\n\t\t\t\theight: 80rpx;\r\n\t\t\t\tbackground-color: #ffce2c;\r\n\t\t\t\tcolor: #fff;\r\n\t\t\t\tborder-radius: 40rpx;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tline-height: 80rpx;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>\r\n","import MiniProgramPage from 'D:/uni-app项目/liuliuzhua/packageB/order/order.vue'\nwx.createPage(MiniProgramPage)"],"names":["onLoad","uni","ref","get","computed","post"],"mappings":";;;;;;;;;;;;;;AAiGAA,kBAAA,OAAO,CAAC,YAAY;AACR;AACX,aAAO,QAAQ,KAAK,MAAM,QAAQ,MAAM;AACpCC,oBAAAA,MAAA,IAAI,mBAAmB,CAAC,oBAAoB;AAC/CA,sBAAA,MAAI,MAAM,OAAM,mCAAkC,UAAU,eAAe;AAC3E,gBAAQ,QAAQ;AAAA,MAAA,CAChB;AAAA,IAAA,CACD;AAGK,UAAA,UAAUC,kBAAiB,CAAA,CAAiB;AAClD,UAAM,aAAa,YAAY;AAC1B,UAAA;AACG,cAAA,SAAe,MAAMC,qBAAI,eAAe;AAC9C,gBAAQ,QAAQ,OAAO,OAAO,UAAQ,KAAK,UAAU,EAAE,CAAC;AACxDF,sBAAA,MAAI,MAAM,OAAM,mCAAkC,QAAQ,OAAM,GAAG;AAAA,eAC3D,OAAO;AACXA,sBAAAA,MAAA,MAAM,OAAM,mCAAkC,KAAK;AAAA,MACxD;AAAA,IAAA;AAGD,UAAM,gBAAgB,MAAM;AAC3BA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK;AAAA,MAAA,CACL;AAAA,IAAA;AAII,UAAA,SAASC,kBAAI,CAAA,CAAE;AAGf,UAAA,aAAaE,cAAAA,SAAiB,MAAM;AACzC,UAAI,QAAQ;AACL,aAAA,MAAM,QAAQ,CAAQ,SAAA;AACnB,iBAAA,OAAO,KAAK,KAAK;AAAA,MAAA,CAC1B;AACM,aAAA;AAAA,IAAA,CACP;AAGD,UAAM,cAAa,YAAU;AAExB,UAAA;AACG,cAAA,MAAQ,MAAMC,iBAAA,KAAK,wBAAuB;AAAA,UAC/C,QAAO;AAAA,UACP,WAAU;AAAA,UACV,aAAY;AAAA,UACZ,cAAa;AAAA,UACb,YAAW;AAAA,QAAA,CACX;AACDJ,sBAAA,MAAI,MAAM,OAAM,mCAAkC,QAAO,GAAG;AAC5DA,sBAAAA,MAAI,eAAe;AAAA,UAClB,UAAS;AAAA,UACT,WAAU;AAAA,UACV,UAAS,IAAI,KAAK;AAAA,UAClB,WAAU,IAAI,KAAK;AAAA,UACnB,SAAQ,IAAI,KAAK;AAAA,UACjB,UAAS,IAAI,KAAK;AAAA,UAClB,SAAQ,IAAI,KAAK;AAAA,UACjB,QAAQ,QAAQ;AACfA,0BAAA,MAAI,MAAM,OAAM,mCAAkC,QAAO,MAAM;AAAA,UAGhE;AAAA,UACA,KAAK,UAAU;AACdA,0BAAAA,MAAI,UAAU;AAAA,cACb,OAAM;AAAA,cACN,MAAK;AAAA,YAAA,CACL;AACDA,0BAAA,MAAI,MAAM,OAAM,mCAAkC,QAAO,QAAQ;AAAA,UAClE;AAAA,QAAA,CACA;AAAA,eACO,OAAO;AACXA,sBAAAA,MAAA,MAAM,OAAM,mCAAkC,KAAK;AAAA,MACxD;AAEIA,oBAAAA,MAAA,MAAM,OAAM,mCAAkC,MAAM;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5KzD,GAAG,WAAW,eAAe;"}